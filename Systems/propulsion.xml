<?xml version="1.0"?>
<!-- based on  HAL V. Engel's p51d, tuning by Heiko H. Schulz; oil managament additions made by Benedikt Hallinger 2017/ 2018 -->

<system name="Propulsion">
    
    <property type="double" value="0">oil-powergain-factor-calc</property>
   

    <channel name="engine power">
  	
<fcs_function name="systems/engine/MP-alt-volumetric-efficiency-curve">
          <function>
                <table>
                    <independentVar lookup="row">atmosphere/density-altitude</independentVar>
                    <independentVar lookup="column">propulsion/engine/map-inhg</independentVar>
                    <tableData breakPoint="0">
			14 	15	16	17	18	19	20	21	22	23	24	25	26	27	28	28.5
		0	0.15	 0.92 0.92	0.92 	0.92 0.92 0.90 0.92 0.925 0.87 0.865 0.855 0.855 0.855 0.945 0.945 
		2000	0.15	0.80 0.80 0.80 0.80 0.80 0.80 0.825 0.835 0.84 0.845 0.85 0.86 0.865 0.865 0.865   
		4000	0.15 0.825 0.825 0.825 0.825 0.825 0.825 0.825 0.835 0.84 0.85	 0.780 0.780 0.780 0.780 0.780
		6000	0.15 0.825	0.825	0.825	0.825	0.825	 0.825 0.84	 0.84	 0.85 0.86	0.80 	0.80 0.80	0.78	0.80	  
		8000	0.15 0.835	0.835	0.835	0.835	0.835	 0.84	 0.84  0.80	0.80  0.80	0.80 	0.80 0.80	0.80	0.80	
		10000 0.15 0.835	0.835	0.835	0.835	0.835	0.77	0.77	0.77	0.77 0.77	0.77  0.77 0.77 0.77 0.77   
		12000 0.15 0.85	0.85	0.85	0.85 0.79 0.79  0.79 0.79 0.79 0.79 0.79	0.79  0.79 0.79 0.79 
		14000 0.15 0.82 0.82 0.77 0.77 0.77 0.77 0.77 0.77 0.77 0.77 0.77 0.77  0.77 0.77 0.77 
                   </tableData> 
                </table>  
          </function>
          <output>propulsion/engine/volumetric-efficiency</output>   
        </fcs_function>


<!--<fcs_function name="systems/engine/MP-alt-bsfc-lbs_hphr-curve">
          <function>
                <table>
                    <independentVar lookup="row">atmosphere/density-altitude</independentVar>
                    <independentVar lookup="column">propulsion/engine/map-inhg</independentVar>
                    <tableData breakPoint="0">
				14	15	16	17	18	19	20	21	22	23	24	25	26	28.5
		0		0.30 0.445 	0.445	0.445	0.445	0.445	0.445	0.445	0.445	0.445 0.445 0.445 0.455 0.48
		1000		0.30 0.458 	0.445	0.445	0.445	0.445	0.445	0.445	0.445	0.445 0.445 0.458 0.458 0.458
		2000		0.30 0.35	0.33	0.33	0.33	0.33	0.33	0.333	0.336	0.32 0.352 0.355 0.455 0.455		
		4000		0.30 0.337 0.337 0.337 0.337 0.337 0.337 0.338 0.339 0.340 0.341 0.417 0.417 0.417	
		6000		0.30 0.425	0.337 0.337 0.337 0.337 0.337 0.338 0.339 0.425 0.425 0.425 0.425 0.425
		8000		0.30	0.340	0.340	0.340	0.340	0.340 0.340 0.340 0.425 0.425 0.425 0.425 0.425 0.425
		10000	0.30	0.341 0.341 0.341 0.341 0.342 0.342 0.415 0.415 0.415 0.415 0.415 0.415 0.415	 
		12000	0.30	0.361	0.361	0.361 0.339 0.39 0.39 0.39 0.39  0.39 0.39 0.39 0.39 0.39 	
		14000	0.30	0.335  0.336 0.40 0.40 0.40 0.40 0.40 0.40 0.40 0.40 0.40 0.40 0.40	
                   </tableData>
                </table>  
          </function>
          <clipto>
             <min> 0.0 </min>
             <max> 1.00 </max>
           </clipto>
          <output>propulsion/engine/bsfc-lbs_hphr</output>   
        </fcs_function>-->

<!-- Power based on fuel flow-->
<fcs_function name="systems/engine/MP-alt-bsfc-lbs_hphr-curve">
          <function>
                <table>
                    <independentVar lookup="row">atmosphere/density-altitude</independentVar>
                    <independentVar lookup="column">propulsion/engine/fuel-flow-rate-gph</independentVar>
                    <tableData breakPoint="0">
				8.0	9.0	13.5	14.5	15.5	16.5	17.5	19.0	20.5
		0		0.345	0.345	0.345	0.415	0.425	0.425	0.437	0.455	0.48
		2000		0.325	0.325	0.355	0.415	0.425	0.425	0.437	0.455	0.48
		4000		0.325	0.325	0.355	0.415	0.425	0.425	0.437	0.455	0.48
		6000		0.335	0.335	0.355	0.415	0.425	0.425	0.437	0.455	0.48
		8000		0.335	0.335	0.355	0.415	0.425	0.425	0.437	0.455	0.48
		10000	0.300	0.300	0.415	0.415	0.437	0.437	0.437	0.455	0.48
		12000	0.270	0.315	0.415	0.435	0.435	0.435	0.437	0.455	0.48
		14000	0.335	0.335	0.445	0.435	0.435	0.435 0.4370.455	0.48
                   </tableData>
                </table>  
          </function>
          <clipto>
             <min> 0.0 </min>
             <max> 1.00 </max>
           </clipto>
          <output>propulsion/engine/bsfc-lbs_hphr</output>   
        </fcs_function>
	
 <fcs_function name="systems/engine/RAM-Air-Factor">
          <function>
                <table>
                    <independentVar lookup="row">atmosphere/density-altitude</independentVar>
                    <tableData breakPoint="0">
					
                        0		0.1		
                        2000	0.2		
                        4000	0.3		
                        6000	0.6		
                        8000	0.9		
                        10000	0.99		 
                        12000	0.99	
                        14000	0.99	
                   </tableData>
                </table>  
          </function>
          <clipto>
             <min> 0.0 </min>
             <max> 1.00 </max>
           </clipto>
          <output>propulsion/engine/ram-air-factor</output>   
        </fcs_function>
	
	
<!--<fcs_function name="systems/engine/Air-Intake-Impedance-Factor">
          <function>
                <table>
                    <independentVar lookup="row">atmosphere/density-altitude</independentVar>
                    <tableData breakPoint="0">
                        0		0.2		
		5000		0.2		
		14000	-0.0	
                   </tableData>
                </table>  
          </function>
          <output>propulsion/engine/air-intake-impedance-factor</output>   
        </fcs_function>-->
	
   
        
        
        <!-- OIL Power gain factor -->
        <!-- (cold oil makes the engine output less power due to reduced viscosity/increased friction) -->
        <!-- This also simulates "running the engine warm" -->
        <switch name="engines/engine/oil-powergain-factor">
            <default value="1"/>
            <test logic="AND" value="oil-powergain-factor-calc">
                /engines/engine/complex-engine-procedures EQ 1
                /engines/engine/allow-oil-management EQ 1
                /sim/start-state-internal/oil-temp-override EQ 0
            </test>
            <output>/engines/engine/oil-powergain-factor</output>
        </switch>
        <fcs_function name="oil-powergain-factor-calc">
            <function>
                <table>
                    <independentVar lookup="row">/engines/engine/oil-final-temperature-degf</independentVar>
                    <tableData breakPoint="0">
                        19.4   2.00   <!-- -7°C -->
                        90.0   1.00   <!-- 32°C --> <!-- engine is considered "hot" -->
                    </tableData>
                </table>  
            </function>
            <clipto>
                <min> 1.0 </min>  <!-- 1=no more better; <1 is boost! -->
                <max> 1.5 </max>  <!-- bigger=less power -->
            </clipto>
            <output>oil-powergain-factor-calc</output>
        </fcs_function>

    </channel>
</system>
